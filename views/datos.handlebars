<h1>Skate Park</h1>

<div class="py-4">
    <h2>Datos del perfil</h2>
    <hr class="w-50" />

    <form id="formActualizar">
        <div class="form-group row w-50 m-auto">
            <div class="form-group col-12 col-sm-6">
                <label for="email">Email</label>
                <input id="email" name="email" type="email" class="form-control m-auto" disabled value="{{inscrito.email}}" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label for="nombre">Nombre</label>
                <input id="nombre" name="nombre" type="text" class="form-control m-auto" value="{{inscrito.nombre}}" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label for="password">Password</label>
                <input id="password" name="password" type="password" class="form-control m-auto" value="" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label for="rptpassword">Repita la password</label>
                <input id="rptpassword" name="rptpassword" type="password" class="form-control m-auto" value="" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label for="experiencia">Años de experiencia</label>
                <input id="experiencia" name="experiencia" type="number" class="form-control m-auto" value="{{inscrito.experiencia}}" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label for="especialidad">Especialidad</label>
                <input id="especialidad" name="especialidad" class="form-control m-auto" value="{{inscrito.especialidad}}" />
            </div>
        </div>
        <div class="mb-1">
            <button id="btnActualizar" name="btnActualizar"  class="btn btn-primary">Actualizar</button>
        </div>
        <div>
            <button id="btnEliminar" name="btnEliminar"  class="btn btn-danger">Eliminar cuenta</button>
        </div>
        
    </form>
</div>

<script>
    document.getElementById("formActualizar").addEventListener("submit", async (event) => 
    {
        event.preventDefault()
        
        const action = event.submitter.id
        if(action == 'btnActualizar') 
        {
            let password = document.querySelector("#password").value;
            let rptpassword = document.querySelector("#rptpassword").value;

            if(password != rptpassword) 
            {
                Swal.fire(
                {
                    title: 'Error!',
                    text: 'Passwords no son identicos.',
                    icon: 'error',
                    confirmButtonText: 'Aceptar'
                })

                return
            }

            try 
            {
                const formData = new FormData(event.target)
                formData.append("email", event.target.email.value)

                const response = await fetch("/inscritos", {
                    method: "PUT",
                    body: formData
                })

                const data = await response.json()
                if (response.status == 500) 
                {
                    Swal.fire(
                    {
                        title: 'Error!',
                        text: 'Error de servidor, inténtalo más tarde',
                        icon: 'error',
                        confirmButtonText: 'Aceptar'
                    })
                }

                if(response.status == 200) 
                {
                    Swal.fire(
                    {
                        title: 'Skater Actualizado!',
                        text: `Usuario Skater actualizado con éxito`,
                        icon: 'success',
                        confirmButtonText: 'Aceptar'
                    })
                    
                    window.location = "/"
                }

            } 
            catch (error) 
            {
                Swal.fire(
                {
                    title: 'Error!',
                    text: 'Error no fue posible actualizar el usuario Skater.',
                    icon: 'error',
                    confirmButtonText: 'Aceptar'
                })
                console.error("Network error", error)
            }
        } 
        else 
        {
            let email = document.querySelector("#email").value;

            const response = await fetch(`/inscrito?email=${email}`, 
            {
                method: "DELETE",
            })

            const data = response.json()

            if (response.status == 500) 
            {
                Swal.fire(
                {
                    title: 'Error!',
                    text: 'Error de servidor, inténtalo más tarde',
                    icon: 'error',
                    confirmButtonText: 'Aceptar'
                })
            } 
            else 
            {
                Swal.fire(
                {
                    title: 'Skater Eliminado!',
                    text: `Usuario eliminado con éxito`,
                    icon: 'success',
                    confirmButtonText: 'Aceptar'
                })
                window.location = "/"
            }
        }
    })

</script>